# Importando bibliotecas
import arcpy
import arcpy.mp
import os
import math

# Definindo Variáveis
projeto = arcpy.mp.ArcGISProject("CURRENT")
m = projeto.listMaps("Map")[0]
diretorio = r"T:\RECAD\Vittoria Torres\Dados\Base Info\Input\ArcGISLevantamento.gdb"
quadras = r"T:\RECAD\Vittoria Torres\Dados\Base Info\Input\Teste_Qds.shp"
lotes = r"T:\RECAD\Vittoria Torres\Dados\Base Info\Input\Teste_Lts.shp"
edific = r"T:\RECAD\Vittoria Torres\Dados\Base Info\Input\Teste_Edific.shp"
logra = r"T:\RECAD\Vittoria Torres\Dados\Base de Dados\CamadasVetoriais\Logradouros.shp"

# Definindo o ambiente de trabalho
arcpy.env.workspace = diretorio

# Definindo nomes de saída para as camadas
lotes_arestas = f"{diretorio}\\Lotes_Arestas"
buffer_15m = f"{diretorio}\\Logra_Buffer_15m"
lotes_testadas = f"{diretorio}\\Lotes_Testadas"
lotes_testadas_m=f"{diretorio}\\Lotes_Testadas_M"
quadra_linha=f"{diretorio}\\Qds_Linha"

# Listar e imprimir os nomes dos campos da camada e seus tipos

campos = arcpy.ListFields(lotes_testadas_m)

# Imprimir os nomes dos campos e seus tipos
print(f"Campos na camada {lotes_testadas_m}:")
for campo in campos:
    print(f"Nome: {campo.name}, Tipo: {campo.type}")

# Este script visa continuar o trabalho inicado no DetermCalculateTesrtada

# Caso existam dúvidas quanto aos campos das camadas criadas:
# Listar e imprimir os nomes dos campos da camada e seus tipos
campos = arcpy.ListFields(lotes_testadas_m)

# Imprimir os nomes dos campos e seus tipos
print(f"Campos na camada {lotes_testadas_m}:")
for campo in campos:
    print(f"Nome: {campo.name}, Tipo: {campo.type}")

# Tranformar polígono Quadra em linha
arcpy.FeatureToLine_management(quadras, quadra_linha)

# ESSA PARTE NECESSITA REVISÃO

try:
    # Reordenar vértices da quadra a partir do ponto 0
    with arcpy.da.UpdateCursor(quadra_linha, ["SHAPE@"]) as cursor:
        for row in cursor:
            # Obter vértices
            polyline = row[0]
            points = [p for p in polyline.getPart(0)]
            
            # Escolher novo ponto inicial (ex.: índice 57)
            # Observação: Antes deve obter o índice do vértice desejado manualmente
            # Ribbon> Edit> Edit Vertices> Select Feature> Select Vertice>
        # Right Click on the selected vertice > Search for the number of the desired index (it will be selected)
            new_start_index = 57  # Substitua pelo índice que você determinou
            
            # Reordenar os pontos começando do novo ponto inicial
            new_points = points[new_start_index:] + points[:new_start_index]
            
            # Criar uma nova linha com a nova ordem de vértices
            new_line = arcpy.Polyline(arcpy.Array([arcpy.Point(p.X, p.Y) for p in new_points]))
            
            # Atualizar o cursor com a nova geometria
            row[0] = new_line
            cursor.updateRow(row)

    print("Os vértices foram reordenados com sucesso")

except arcpy.ExecuteError as e:
    print(f"Erro ao reordenar vértices: {e}")

except Exception as e:
    print(f"Erro geral: {e}")
    
# PROBLEMA: APÓS A OPERAÇÃO, PARTE DA LINHHA PODE SUMIR. ESTOU REALIZANDO 'Continue Feature'